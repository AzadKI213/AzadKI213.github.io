---
import '../styles/global.css';

const all = await Astro.glob('../content/blog/**/*.md');
const showDrafts = Astro.request.url.includes('drafts=1');
const posts = all
  .filter((p) => (showDrafts ? true : p.frontmatter?.draft !== true))
  .sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date));

const recent = posts.slice(0, 4);
const featured = recent[0];
const formatDate = (d) => new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: '2-digit' });

const SITE_TITLE = 'Frost Journal';
const SITE_DESC = 'Quiet essays about deliberate work, useful tools, and building with intention.';
const AUTHOR_NAME = 'Azad KI';
const AUTHOR_BIO = 'Product-minded maker documenting calm workflows, prototypes, and lessons learned.';

const CONTACT_EMAIL = 'you@example.com';
const GITHUB_URL = 'https://github.com/AzadKI213';

const base = Astro.site?.pathname || '/';
const assets = (p) => `${base}${p}`.replace('//', '/');
const archiveUrl = assets('blog/');
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{SITE_TITLE}</title>
  <meta name="description" content={SITE_DESC} />
  <link rel="icon" href={assets('favicon.svg')} />
  <link rel="stylesheet" href={assets('src/styles/global.css')} />
  <meta property="og:title" content={SITE_TITLE} />
  <meta property="og:description" content={SITE_DESC} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={new URL(Astro.request.url, Astro.site ?? 'http://localhost/').toString()} />
</head>
<body>
  <div class="container">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href={assets('')}>
        <svg viewBox="0 0 64 64" aria-hidden="true" focusable="false">
          <defs>
            <linearGradient id="aurora" x1="0" x2="1">
              <stop offset="0%" stop-color="#4b6fae" />
              <stop offset="100%" stop-color="#7aa6d9" />
            </linearGradient>
          </defs>
          <rect x="10" y="18" width="44" height="28" rx="14" fill="none" stroke="url(#aurora)" stroke-width="3" />
          <path d="M16 32 L32 22 L48 32" fill="none" stroke="url(#aurora)" stroke-width="3" stroke-linecap="round" />
        </svg>
        <span>{SITE_TITLE.toUpperCase()}</span>
      </a>
      <div class="menu">
        <a class="chip" href="#writing">Writing</a>
        <a class="chip" href="#about">About</a>
        <a class="chip" href="#workflow">Workflow</a>
        <a class="chip" href={archiveUrl}>Archive</a>
      </div>
    </nav>

    <section id="writing" class="hero" role="region" aria-label="Featured writing">
      <div class="hero-copy">
        <p class="eyebrow">Personal blog</p>
        <h1>Quiet notes for people who build with care.</h1>
        <p class="kicker">{SITE_DESC}</p>
        <div class="cta">
          {featured ? (
            <a class="btn primary" href={assets(`blog/${featured.file.split('/').pop().replace(/\.md$/, '')}/`)}>Read the latest</a>
          ) : (
            <a class="btn primary" href={archiveUrl}>Browse posts</a>
          )}
          <a class="btn" href={archiveUrl}>View archive</a>
        </div>
      </div>

      <div class="hero-panels">
        <div class="panel">
          <h2>Latest writing</h2>
          {recent.length === 0 ? (
            <p class="meta">No posts yet — publish your first note to see it here.</p>
          ) : (
            <ul class="post-list" aria-label="Recent posts">
              {recent.map((p) => {
                const slug = p.file.split('/').pop().replace(/\.md$/, '');
                const url = assets(`blog/${slug}/`);
                return (
                  <li>
                    <a class="title" href={url}>{p.frontmatter.title}</a>
                    <span class="meta">{formatDate(p.frontmatter.date)}</span>
                  </li>
                );
              })}
            </ul>
          )}
          <a class="text-link" href={archiveUrl}>Open the full archive →</a>
        </div>

        <div class="panel">
          <h2>Stay in touch</h2>
          <p class="meta">Follow along or say hello.</p>
          <div class="cta">
            <a class="btn" href={GITHUB_URL} target="_blank" rel="noopener">GitHub</a>
            <a class="btn" href={`mailto:${CONTACT_EMAIL}`}>Email</a>
            <a class="btn" href={assets('rss.xml')}>RSS</a>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="sections">
      <article class="card highlight">
        <h2>About {AUTHOR_NAME}</h2>
        <p>{AUTHOR_BIO}</p>
        <p class="meta">Currently writing from a calm, minimalist workspace — capturing the build logs as they happen.</p>
      </article>

      <article id="workflow" class="card">
        <h2>Publishing workflow</h2>
        <ol class="steps">
          <li><strong>Install</strong>: <code>npm install</code> to set up dependencies.</li>
          <li><strong>Draft</strong>: <code>npm run new "Title" --tags="Notes"</code> creates a Markdown file under <code>src/content/blog/</code>.</li>
          <li><strong>Review</strong>: Run <code>npm run dev</code> and edit until it feels right.</li>
          <li><strong>Publish</strong>: Commit the changes and push — GitHub Pages takes care of deployment.</li>
        </ol>
        <p class="meta">Every article is versioned, so you can trace edits or roll back without stress.</p>
      </article>

      <article class="card">
        <h2>What you can expect</h2>
        <ul class="plain-list">
          <li>Thoughtful essays with a bias toward calm productivity.</li>
          <li>Snapshots of prototypes, from small scripts to shipped features.</li>
          <li>Curated links that keep the signal high and the noise low.</li>
        </ul>
      </article>
    </section>

    <footer>
      <span>© {new Date().getFullYear()} {SITE_TITLE}</span>
      <span class="meta">Built with Astro · Deployed via GitHub Pages</span>
    </footer>
  </div>
</body>
</html>
